<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Dashboard - The Bridge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;700;900&display=swap');
        body { font-family: 'Prompt', sans-serif; background-color: #020617; }
        .bill-card { 
            min-width: 320px; max-width: 380px;
            background: #1e293b; border-top: 10px solid #3b82f6;
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-white p-4">
    <div class="max-w-full mx-auto">
        <div class="flex justify-between items-center mb-6 bg-slate-800 p-5 rounded-2xl border-b-4 border-blue-500 shadow-2xl">
            <div>
                <h1 class="text-2xl font-black text-blue-400 uppercase tracking-tighter">Kitchen Live Monitor 3.0</h1>
                <p id="status" class="text-green-400 font-bold italic text-sm">‚óè CONNECTED & WAITING...</p>
            </div>
            <button onclick="location.reload()" class="bg-red-600/20 text-red-500 px-4 py-2 rounded-lg font-bold border border-red-500 hover:bg-red-600 hover:text-white transition-all text-xs">‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</button>
        </div>

        <div id="orderQueue" class="flex flex-wrap gap-6 justify-start items-start pb-40">
            <div id="placeholder" class="text-slate-700 italic text-xl p-20 w-full text-center border-4 border-dashed border-slate-900 rounded-3xl">
                ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å Order Pin...<br>
                <span class="text-sm">(‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≠‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ß" ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Order Pin)</span>
            </div>
        </div>
    </div>

    <script>
        let API_KEY = localStorage.getItem('chef_api_key') || "";
        const MODEL = "gemini-1.5-flash";

        // --- ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÅ‡∏ö‡∏ö‡∏ï‡∏∞‡πÇ‡∏Å‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á ---
        window.addEventListener("message", (event) => {
            if (event.data && event.data.type === "ORDER_PIN_DATA") {
                console.log("üì• ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà!");
                processOrderData(event.data.data);
            }
        }, false);

        async function processOrderData(jsonData) {
            if(!API_KEY) {
                API_KEY = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ä‡∏ü‡∏Ñ‡∏£‡∏±‡∏ö:");
                if(API_KEY) {
                    localStorage.setItem('chef_api_key', API_KEY.trim());
                    location.reload();
                }
                return;
            }

            const status = document.getElementById('status');
            status.innerText = "üåÄ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£...";
            status.className = "text-yellow-400 font-bold italic animate-pulse";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ 
                            text: `‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•: ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞, ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ï‡πà‡∏≠‡πÜ‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ () ‡πÅ‡∏•‡∏∞ +) ‡πÅ‡∏¢‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏ï‡πä‡∏∞‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${JSON.stringify(jsonData)}` 
                        }] }]
                    })
                });

                const resData = await response.json();
                const result = resData.candidates[0].content.parts[0].text.trim();
                
                if (document.getElementById('placeholder')) document.getElementById('placeholder').remove();

                // ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡πÇ‡∏ï‡πä‡∏∞
                const tables = result.split(/‡πÇ‡∏ï‡πä‡∏∞|Table/gi).filter(t => t.trim().length > 5);
                tables.forEach(tableInfo => {
                    addOrderToUI("‡πÇ‡∏ï‡πä‡∏∞" + tableInfo.replace(/[()+]/g, ' '));
                });

                status.innerText = "‚óè READY";
                status.className = "text-green-400 font-bold italic";
            } catch (e) {
                status.innerText = "‚ùå AI Error: ‡πÄ‡∏ä‡πá‡∏Ñ Key ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ô‡πá‡∏ï";
            }
        }

        function addOrderToUI(text) {
            const queue = document.getElementById('orderQueue');
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const lines = text.split('\n').filter(l => l.trim() !== "");
            const tableNo = lines[0];
            const items = lines.slice(1).join('<br>');

            const card = document.createElement('div');
            card.className = "bill-card p-6 rounded-2xl shadow-2xl relative flex-none";
            card.innerHTML = `
                <div class="text-4xl font-black text-yellow-400 border-b-2 border-slate-700 mb-3 pb-2 uppercase">${tableNo}</div>
                <div class="text-2xl font-bold text-white leading-tight">${items}</div>
                <div class="text-xs text-slate-500 mt-5 font-bold text-right">${time}</div>
                <button onclick="this.parentElement.remove()" class="absolute -top-3 -right-3 bg-red-600 w-10 h-10 rounded-full flex items-center justify-center font-bold text-white shadow-lg">‚úï</button>
            `;
            queue.appendChild(card);
        }
    </script>
</body>
</html>
