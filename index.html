<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef Dashboard - Order Pin Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;700;900&display=swap');
        body { font-family: 'Prompt', sans-serif; background-color: #020617; }
        .bill-card { 
            min-width: 300px; max-width: 350px;
            background: #1e293b; border-top: 10px solid #3b82f6;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-white p-4">
    <div class="max-w-full mx-auto">
        <div class="flex justify-between items-center mb-6 bg-slate-800 p-5 rounded-2xl border-b-4 border-blue-500 shadow-2xl">
            <div>
                <h1 class="text-2xl font-black text-blue-400 uppercase tracking-tighter">Kitchen Live Monitor</h1>
                <p id="status" class="text-green-400 font-bold italic text-sm animate-pulse">‚óè READY: WAITING FOR ORDER PIN...</p>
            </div>
            <div class="flex gap-4">
                <button onclick="clearOrders()" class="text-red-500 font-bold text-sm border border-red-500/50 px-3 py-1 rounded-lg hover:bg-red-500/10">‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏≠</button>
                <button onclick="localStorage.removeItem('chef_api_key'); location.reload();" class="text-slate-400 font-bold text-sm border border-slate-600 px-3 py-1 rounded-lg">‡πÅ‡∏Å‡πâ KEY</button>
            </div>
        </div>

        <div id="orderQueue" class="flex flex-wrap gap-6 justify-start items-start pb-40">
            <div id="placeholder" class="text-slate-700 italic text-2xl p-20 w-full text-center border-4 border-dashed border-slate-900 rounded-3xl">
                ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Order Pin
            </div>
        </div>
    </div>

    <script>
        let API_KEY = localStorage.getItem('chef_api_key') || "";
        const MODEL = "gemini-1.5-flash"; // ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß

        // 1. ‡∏ï‡∏±‡∏ß‡∏î‡∏±‡∏Å‡∏ü‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≤‡∏° Tab ‡∏à‡∏≤‡∏Å Tampermonkey
        window.addEventListener('storage', (event) => {
            if (event.key === 'latest_order_pin' && event.newValue) {
                const data = JSON.parse(event.newValue);
                processOrderData(data);
                // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                localStorage.removeItem('latest_order_pin');
            }
        });

        async function processOrderData(jsonData) {
            if(!API_KEY) {
                const key = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ä‡∏ü‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö:");
                if(key) {
                    localStorage.setItem('chef_api_key', key.trim());
                    location.reload();
                }
                return;
            }

            const status = document.getElementById('status');
            status.innerText = "üåÄ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ORDER PIN...";
            status.className = "text-yellow-400 font-bold italic animate-bounce";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ 
                            text: `‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏à‡∏≤‡∏Å Order Pin ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•' ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 
                            ‡πÇ‡∏î‡∏¢‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏•‡∏∞ 1 ‡πÇ‡∏ï‡πä‡∏∞: 
                            - ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å: ‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞ (Table Number) 
                            - ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ï‡πà‡∏≠‡πÜ‡πÑ‡∏õ: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ () ‡πÅ‡∏•‡∏∞ + ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
                            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${JSON.stringify(jsonData)}` 
                        }] }]
                    })
                });

                const resData = await response.json();
                const result = resData.candidates[0].content.parts[0].text.trim();
                
                // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤ (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏Å‡πá‡πÑ‡∏î‡πâ)
                const placeholder = document.getElementById('placeholder');
                if (placeholder) placeholder.remove();

                // ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏ï‡πä‡∏∞ (‡∏Å‡∏£‡∏ì‡∏µ AI ‡∏™‡πà‡∏á‡∏°‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡πÇ‡∏ï‡πä‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô)
                const tables = result.split(/‡πÇ‡∏ï‡πä‡∏∞|Table/gi).filter(t => t.trim().length > 5);
                tables.forEach(tableInfo => {
                    addOrderToUI("‡πÇ‡∏ï‡πä‡∏∞" + tableInfo.replace(/[()+]/g, ' '));
                });

                status.innerText = "‚óè READY: ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
                status.className = "text-green-400 font-bold italic";
            } catch (e) {
                status.innerText = "‚ùå ERROR: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API KEY ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ô‡πá‡∏ï";
                console.error(e);
            }
        }

        function addOrderToUI(text) {
            const queue = document.getElementById('orderQueue');
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            const lines = text.split('\n').filter(l => l.trim() !== "");
            const tableNo = lines[0];
            const menuItems = lines.slice(1).join('<br>');

            const card = document.createElement('div');
            card.className = "bill-card p-6 rounded-2xl shadow-2xl relative flex-none";
            card.innerHTML = `
                <div class="text-4xl font-black text-yellow-400 border-b-2 border-slate-700 mb-3 pb-2 uppercase">${tableNo}</div>
                <div class="text-2xl font-bold text-white leading-tight">${menuItems}</div>
                <div class="text-xs text-slate-500 mt-5 font-bold text-right">${time}</div>
                <button onclick="this.parentElement.remove()" class="absolute -top-3 -right-3 bg-red-600 w-10 h-10 rounded-full flex items-center justify-center font-bold text-white shadow-lg hover:scale-110 active:scale-95 transition-all">‚úï</button>
            `;
            queue.appendChild(card);
        }

        function clearOrders() { if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) location.reload(); }
    </script>
</body>
</html>
