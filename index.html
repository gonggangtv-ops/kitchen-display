<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Chef Dashboard - Cloud Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;700;900&display=swap');
        body { font-family: 'Prompt', sans-serif; background-color: #020617; color: white; overflow-x: hidden; }
        .bill-card { 
            min-width: 320px; max-width: 380px;
            background: #1e293b; border-top: 10px solid #3b82f6; 
            border-radius: 1.5rem; animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="p-6">
    <div class="flex justify-between items-center mb-8 bg-slate-800 p-6 rounded-2xl border-b-4 border-blue-500 shadow-2xl">
        <div>
            <h1 class="text-3xl font-black text-blue-400 uppercase tracking-tighter">Kitchen Monitor (Cloud Mode)</h1>
            <p id="status" class="text-green-400 font-bold italic text-sm">‚óè ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ù‡πâ‡∏≤‡∏î‡∏π‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å Cloud...</p>
        </div>
        <div class="flex gap-4">
            <button onclick="location.reload()" class="bg-slate-700 px-4 py-2 rounded-xl font-bold text-xs">RELOAD</button>
            <button onclick="localStorage.removeItem('chef_api_key'); location.reload();" class="bg-slate-700 px-4 py-2 rounded-xl font-bold text-xs text-slate-400">RESET KEY</button>
        </div>
    </div>

    <div id="orderQueue" class="flex flex-wrap gap-6 items-start">
        <div id="placeholder" class="w-full text-center py-20 text-slate-800 italic text-2xl border-4 border-dashed border-slate-900 rounded-3xl">
            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Order Pin...
        </div>
    </div>

    <script>
        let API_KEY = localStorage.getItem('chef_api_key') || "";
        const WEBHOOK_ID = "d9de0127-8994-4253-bc6f-25d59d0b2b73";
        let lastRequestID = "";

        async function checkCloudData() {
            if(!API_KEY) {
                API_KEY = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Gemini API Key:");
                if(API_KEY) localStorage.setItem('chef_api_key', API_KEY.trim());
                return;
            }

            try {
                // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Webhook.site API
                const response = await fetch(`https://webhook.site/token/${WEBHOOK_ID}/requests?sorting=newest&limit=1`);
                const result = await response.json();
                
                if (result.data && result.data.length > 0) {
                    const latest = result.data[0];
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
                    if (latest.uuid !== lastRequestID) {
                        lastRequestID = latest.uuid;
                        processOrderData(JSON.parse(latest.content));
                    }
                }
            } catch (e) { console.log("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå..."); }
        }

        async function processOrderData(jsonData) {
            const status = document.getElementById('status');
            status.innerText = "üåÄ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏õ‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ AI...";
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ 
                            text: `‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•‡∏≠‡∏≤‡∏´‡∏≤‡∏£: ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞, ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏°‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ () ‡πÅ‡∏•‡∏∞ + ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∑‡∏≠: ${JSON.stringify(jsonData)}` 
                        }] }]
                    })
                });
                const resData = await response.json();
                const text = resData.candidates[0].content.parts[0].text.trim();
                
                if (document.getElementById('placeholder')) document.getElementById('placeholder').remove();
                addOrderToUI(text);
                status.innerText = "‚óè READY - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡πà";
            } catch (e) {
                status.innerText = "‚ùå AI ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏û‡∏•‡∏≤‡∏î";
            }
        }

        function addOrderToUI(text) {
            const queue = document.getElementById('orderQueue');
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const lines = text.split('\n');
            const table = lines[0];
            const items = lines.slice(1).join('<br>');

            const card = document.createElement('div');
            card.className = "bill-card p-6 relative shadow-2xl";
            card.innerHTML = `
                <div class="text-4xl font-black text-yellow-400 border-b border-slate-700 mb-3 pb-1 uppercase">${table}</div>
                <div class="text-2xl font-bold text-white leading-tight">${items}</div>
                <div class="text-xs text-slate-500 mt-5 text-right font-bold">${time}</div>
                <button onclick="this.parentElement.remove()" class="absolute -top-3 -right-3 bg-red-600 w-10 h-10 rounded-full font-bold shadow-lg hover:scale-110 active:scale-90 transition-all">‚úï</button>
            `;
            queue.appendChild(card);
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setInterval(checkCloudData, 5000);
    </script>
</body>
</html>
