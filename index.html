<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef Dashboard Pro (Order Pin Sync)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;700;900&display=swap');
        body { font-family: 'Prompt', sans-serif; background-color: #020617; }
        .bill-card { 
            min-width: 280px; max-width: 320px;
            background: #1e293b; border-top: 10px solid #3b82f6;
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-white p-4">
    <div class="max-w-full mx-auto">
        <div class="flex justify-between items-center mb-6 bg-slate-800 p-4 rounded-2xl border-b-4 border-blue-500 shadow-2xl">
            <div>
                <h1 class="text-2xl font-black text-blue-400 uppercase">Kitchen Dashboard</h1>
                <p id="status" class="text-green-400 font-bold italic text-sm">‚óè WAITING FOR ORDER PIN...</p>
            </div>
            <button onclick="clearOrders()" class="bg-red-600/20 text-red-500 px-4 py-2 rounded-lg font-bold border border-red-500 hover:bg-red-600 hover:text-white transition-all">CLEAR ALL</button>
        </div>

        <div id="orderQueue" class="flex flex-wrap gap-6 justify-start items-start pb-32">
            <div id="placeholder" class="text-slate-600 italic text-xl p-10 w-full text-center border-2 border-dashed border-slate-800 rounded-3xl">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤... (‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Order Pin)
            </div>
        </div>
    </div>

    <script>
        // ‡πÉ‡∏™‡πà API Key ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ä‡∏ü‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏≤‡∏°‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å)
        let API_KEY = localStorage.getItem('chef_api_key') || "";
        const MODEL = "gemini-2.5-flash";

        // 1. ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏±‡∏Å‡∏ü‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≤‡∏° Tab (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
        window.addEventListener('storage', (event) => {
            if (event.key === 'latest_order_pin' && event.newValue) {
                const data = JSON.parse(event.newValue);
                processOrderData(data);
                // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ
                localStorage.removeItem('latest_order_pin');
            }
        });

        async function processOrderData(data) {
            if(!API_KEY) {
                API_KEY = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏ü:");
                if(API_KEY) localStorage.setItem('chef_api_key', API_KEY);
                return;
            }

            const status = document.getElementById('status');
            status.innerText = "üåÄ PROCESSING NEW ORDER...";
            status.className = "text-yellow-400 font-bold italic animate-pulse";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ 
                            text: `‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•: ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞, ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ï‡πà‡∏≠‡πÜ‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ () ‡πÅ‡∏•‡∏∞ + ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∑‡∏≠: ${JSON.stringify(data)}` 
                        }] }]
                    })
                });
                const resData = await response.json();
                const result = resData.candidates[0].content.parts[0].text.trim();
                
                addOrderToUI(result.replace(/[()+]/g, ' '));
                status.innerText = "‚óè READY - WAITING FOR NEXT...";
                status.className = "text-green-400 font-bold italic";
            } catch (e) {
                status.innerText = "‚ùå ERROR PROCESSING DATA";
                console.error(e);
            }
        }

        function addOrderToUI(text) {
            const queue = document.getElementById('orderQueue');
            const placeholder = document.getElementById('placeholder');
            if (placeholder) placeholder.remove();

            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const lines = text.split('\n').filter(l => l.trim() !== "");
            const table = lines[0];
            const items = lines.slice(1).join('<br>');

            const card = document.createElement('div');
            card.className = "bill-card p-6 rounded-2xl shadow-2xl relative flex-none";
            card.innerHTML = `
                <div class="text-4xl font-black text-yellow-400 border-b border-slate-600 mb-3 pb-2 uppercase">${table}</div>
                <div class="text-2xl font-bold text-white leading-snug">${items}</div>
                <div class="text-xs text-slate-500 mt-4 font-bold text-right">${time}</div>
                <button onclick="this.parentElement.remove()" class="absolute -top-3 -right-3 bg-red-600 w-10 h-10 rounded-full flex items-center justify-center font-bold text-white shadow-lg hover:scale-110 transition-all">‚úï</button>
            `;
            queue.appendChild(card);
        }

        function clearOrders() { if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) location.reload(); }
    </script>
</body>
</html>
